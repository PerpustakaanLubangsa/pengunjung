<!doctype html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Feedback & Keresahan Perpustakaan</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Poppins', 'sans-serif'],
            },
            colors: {
              'primary-accent': '#02BABA', 
              'soft-bg': '#F7F8FC',
              'card-bg': '#FFFFFF',
              'soft-border': '#E5E7EB',
            }
          }
        }
      }
    </script>

    <style>
      /* --- Variabel CSS --- */
      :root {
          --color-primary-accent: #00CCCC;
          --color-secondary-accent: #02BABA;
          --color-light-main-bg: #F7F8FC;
          --color-light-container-bg: #FFFFFF;
          --color-light-border: #E5E7EB;
          --color-text-dark: #1F2937;
      }

      /* Struktur Utama */
      body {
          font-family: 'Poppins', sans-serif;
          background-color: var(--color-light-main-bg);
          color: var(--color-text-dark);
          display: flex;
          justify-content: center;
          align-items: flex-start;
          min-height: 100vh;
          padding: 40px 20px;
      }

      /* Kontainer Formulir */
      #formContainer {
          max-width: 600px;
          padding: 40px;
          margin: 0 auto;
          background: var(--color-light-container-bg);
          border-radius: 12px;
          width: 100%;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
          border: 1px solid var(--color-light-border);
      }
      
      /* Gaya Input & Textarea */
      .input-style {
          width: 100%; padding: 12px; border: 1px solid var(--color-light-border); outline: none;
          border-radius: 8px; background-color: var(--color-soft-gray-focus, #F9FAFB);
          transition: border-color 0.3s;
          font-size: 16px; box-sizing: border-box; resize: vertical;
      }
      .input-style:focus {
          border-color: var(--color-primary-accent);
          box-shadow: 0 0 0 3px rgba(2, 186, 186, 0.3);
      }
      .input-style.error { border-color: #EF4444 !important; }

      /* Tombol Kirim */
      #btnSubmitFeedback {
          background-color: var(--color-primary-accent); color: white; padding: 14px 25px;
          border: none; border-radius: 8px; cursor: pointer; 
          font-size: 17px; font-weight: 700;
          transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s;
          width: 100%; box-shadow: 0 4px 10px rgba(79, 70, 229, 0.4);
          margin-top: 20px;
      }
      #btnSubmitFeedback:hover { 
          background-color: #02BABA; 
          transform: translateY(-1px); 
          box-shadow: 0 6px 15px rgba(79, 70, 229, 0.6); 
      }
      #btnSubmitFeedback:disabled { 
          background-color: #9CA3AF; 
          cursor: not-allowed; 
          transform: none; 
          box-shadow: none; 
      }
      
      /* Tombol Kembali */
      #btnBack {
          background-color: #F3F4F6;
          color: var(--color-text-dark);
          border: 1px solid #D1D5DB;
      }
      #btnBack:hover {
          background-color: #E5E7EB;
      }

      /* Modal Sukses/Gagal */
      .modal-overlay {
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center;
          z-index: 2000; opacity: 0; transition: opacity 0.3s;
      }
      .modal-overlay.active { display: flex; opacity: 1; }
      .modal-content {
          background: var(--color-light-container-bg); padding: 30px; border-radius: 12px;
          max-width: 400px;
          width: 90%; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
          transform: scale(0.9); transition: transform 0.3s;
      }
      .modal-overlay.active .modal-content { transform: scale(1); }
      .text-cyan-500-custom { color: var(--color-secondary-accent); }
    </style>
</head>

<body>
    <div id="formContainer">
      <h1 class="text-3xl font-bold text-gray-800 mb-2 border-b-4 pb-3 border-primary-accent">üó£Ô∏è Saran & Keresahan</h1>
      <p class="text-gray-600 mb-8">Sampaikan kritik, saran, atau keresahan Anda kepada pihak Pustakawan secara anonim atau dengan menyertakan identitas.</p>

      <form id="feedbackForm" class="space-y-5">
          <div class="form-group">
              <label for="nama" class="block text-sm font-medium text-gray-600 mb-1">Nama (Opsional)</label>
              <input type="text" id="nama" class="input-style" placeholder="Cth: Anggota Arief / Anonim">
          </div>
          
          <div class="form-group">
              <label for="judul" class="block text-sm font-medium text-gray-600 mb-1">Topik/Judul Masukan <span class="text-red-500">*</span></label>
              <input type="text" id="judul" class="input-style" placeholder="Cth: Keterlambatan Pengembalian Buku" required>
          </div>

          <div class="form-group">
              <label for="feedbackText" class="block text-sm font-medium text-gray-600 mb-1">Isi Saran / Keresahan <span class="text-red-500">*</span></label>
              <textarea id="feedbackText" class="input-style" rows="6" placeholder="Tuliskan masukan, kritik, atau keresahan Anda di sini..." required></textarea>
          </div>

          <button type="submit" id="btnSubmitFeedback">Kirim Saran & Keresahan</button>

          <a href="index.html" id="btnBack" class="px-6 py-3 rounded-lg font-semibold transition mt-4 block text-center">
             < Kembali ke Formulir Kunjungan
          </a>
      </form>
    </div>

    <div id="statusModal" class="modal-overlay">
      <div class="modal-content text-center">
        <div id="modalIcon" class="text-6xl mb-4 text-cyan-500-custom">
          </div>
        <h4 id="modalTitle" class="text-2xl font-bold text-gray-800 mb-2"></h4>
        <p id="modalMessage" class="text-gray-600 mb-6"></p>
        
        <button onclick="window.location.href='index.html'" class="bg-primary-accent hover:bg-02BABA text-white px-6 py-2 rounded-lg font-semibold transition">
            Kembali ke Formulir Utama
        </button>
      </div>
    </div>

    <script type="module">
        // --- FIREBASE IMPORTS (Hanya untuk referensi, disarankan menggunakan config nyata) ---
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
        import { getDatabase, ref, push } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js';

        // ‚ö†Ô∏è KRITIS: GANTI DENGAN CONFIG FIREBASE ASLI PROYEK ANDA
        const firebaseConfig = {
            apiKey: "AIzaSy_GANTI_INI_DENGAN_KUNCI_API_ASLI",
            authDomain: "traying-29bf4.firebaseapp.com",
            projectId: "traying-29bf4",
            databaseURL: "https://traying-29bf4-default-rtdb.firebaseio.com"
        };
        
        // Inisialisasi Firebase (jika data benar)
        let db = null;
        try {
            const app = initializeApp(firebaseConfig);
            db = getDatabase(app);
            console.log("Firebase initialized for Feedback.");
        } catch(e) {
            console.error("Firebase Gagal diinisialisasi di halaman feedback:", e);
        }

        // --- DOM REFERENCES ---
        const $ = id => document.getElementById(id);
        
        const DOM = {
            nama: $('nama'),
            judul: $('judul'),
            feedbackText: $('feedbackText'),
            btnSubmitFeedback: $('btnSubmitFeedback'),
            feedbackForm: $('feedbackForm'),
            statusModal: $('statusModal'),
            modalIcon: $('modalIcon'),
            modalTitle: $('modalTitle'),
            modalMessage: $('modalMessage'),
        };

        // --- HELPER FUNCTIONS ---
        
        /** Mengubah string menjadi Title Case. */
        const titleCase = (str) => {
            if (!str) return '';
            return str.toLowerCase().split(' ').map(word => {
                if (word.length === 0) return '';
                return word.charAt(0).toUpperCase() + word.slice(1);
            }).join(' ');
        };

        /** Menampilkan modal status. */
        const showModal = (isSuccess, title, message) => {
            if (isSuccess) {
                DOM.modalIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
                DOM.modalTitle.textContent = title;
                DOM.modalMessage.textContent = message;
                DOM.modalIcon.classList.add('text-cyan-500-custom');
                DOM.modalIcon.classList.remove('text-red-500');
            } else {
                DOM.modalIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.398 16c-.77 1.333.192 3 1.732 3z" /></svg>`;
                DOM.modalTitle.textContent = title;
                DOM.modalMessage.textContent = message;
                DOM.modalIcon.classList.add('text-red-500');
                DOM.modalIcon.classList.remove('text-cyan-500-custom');
            }
            DOM.statusModal.classList.add('active');
        };

        /** Reset formulir. */
        const resetForm = () => {
            DOM.nama.value = '';
            DOM.judul.value = '';
            DOM.feedbackText.value = '';
            DOM.judul.classList.remove('error');
            DOM.feedbackText.classList.remove('error');
        };


        // --- EVENT HANDLERS ---
        
        DOM.feedbackForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Validasi Sederhana
            const judul = DOM.judul.value.trim();
            const feedbackText = DOM.feedbackText.value.trim();
            let hasError = false;

            if (!judul) { DOM.judul.classList.add('error'); hasError = true; } else { DOM.judul.classList.remove('error'); }
            if (!feedbackText) { DOM.feedbackText.classList.add('error'); hasError = true; } else { DOM.feedbackText.classList.remove('error'); }
            
            if (hasError) return;

            DOM.btnSubmitFeedback.disabled = true;
            DOM.btnSubmitFeedback.textContent = 'Mengirim...';

            const now = new Date();
            const payload = {
                nama: titleCase(DOM.nama.value.trim() || "Anonim"),
                judul: titleCase(judul),
                isi: feedbackText,
                tanggal: `${String(now.getDate()).padStart(2, '0')}/${String(now.getMonth() + 1).padStart(2, '0')}/${now.getFullYear()}`,
                jam: now.toTimeString().substring(0, 5),
                timestamp: now.getTime(),
                status: "Baru"
            };

            try{
                if (db) {
                    // MENGIRIM DATA KE FIREBASE DI PATH KHUSUS
                    await push(ref(db, `log_feedback`), payload);
                    
                    showModal(true, 'Masukan Berhasil Dikirim! üòä', 'Terima kasih atas waktu dan masukan Anda. Kami akan segera meninjau pesan ini.');
                    resetForm();
                } else {
                    // Simpan data di Console/Session jika Firebase gagal
                    console.log("SIMULASI: Data Feedback berhasil dikumpulkan.", payload);
                    showModal(true, 'Masukan Berhasil Dikirim!', 'Mode Simulasi: Data dikirim ke konsol. Harap perbaiki konfigurasi Firebase Anda.');
                    resetForm();
                }

            } catch(error){
                console.error("Firebase Feedback Submit Error:", error);
                showModal(false, 'Gagal Mengirim Masukan üò¢', `Terjadi kesalahan saat mencoba mengirim data. Detail: ${error.message}`);
            } finally {
                DOM.btnSubmitFeedback.disabled = false;
                DOM.btnSubmitFeedback.textContent = 'Kirim Saran & Keresahan';
            }
        });
        
        // Hapus penanda error saat user mulai mengetik
        DOM.judul.addEventListener('input', () => DOM.judul.classList.remove('error'));
        DOM.feedbackText.addEventListener('input', () => DOM.feedbackText.classList.remove('error'));

    </script>
</body>
</html>